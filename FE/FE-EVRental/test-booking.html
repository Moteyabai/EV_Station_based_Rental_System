<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Booking System</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      h2 {
        color: #4db6ac;
        border-bottom: 2px solid #4db6ac;
        padding-bottom: 10px;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
      }
      .btn-primary {
        background: #4db6ac;
        color: white;
      }
      .btn-danger {
        background: #ef4444;
        color: white;
      }
      .btn-success {
        background: #10b981;
        color: white;
      }
      .btn-info {
        background: #3b82f6;
        color: white;
      }
      button:hover {
        opacity: 0.8;
      }
      pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        max-height: 400px;
        font-size: 12px;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
      }
      .stat-number {
        font-size: 32px;
        font-weight: bold;
      }
      .stat-label {
        font-size: 14px;
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª Test Booking System</h1>

    <div class="container">
      <h2>ğŸ“Š Thá»‘ng kÃª LocalStorage</h2>
      <div class="stats">
        <div class="stat-card">
          <div class="stat-number" id="totalBookings">0</div>
          <div class="stat-label">Tá»•ng Bookings</div>
        </div>
        <div
          class="stat-card"
          style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
        >
          <div class="stat-number" id="pendingBookings">0</div>
          <div class="stat-label">Chá» thanh toÃ¡n</div>
        </div>
        <div
          class="stat-card"
          style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
        >
          <div class="stat-number" id="bookedBookings">0</div>
          <div class="stat-label">ÄÃ£ xÃ¡c nháº­n</div>
        </div>
        <div
          class="stat-card"
          style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"
        >
          <div class="stat-number" id="completedBookings">0</div>
          <div class="stat-label">HoÃ n thÃ nh</div>
        </div>
      </div>
      <button class="btn-info" onclick="loadStats()">ğŸ”„ LÃ m má»›i</button>
    </div>

    <div class="container">
      <h2>ğŸ”§ CÃ´ng cá»¥ Test</h2>
      <button class="btn-primary" onclick="createTestBooking()">
        â• Táº¡o Test Booking
      </button>
      <button class="btn-success" onclick="viewAllBookings()">
        ğŸ‘ï¸ Xem táº¥t cáº£ Bookings
      </button>
      <button class="btn-info" onclick="checkStructure()">
        ğŸ” Kiá»ƒm tra cáº¥u trÃºc
      </button>
      <button class="btn-danger" onclick="clearAllBookings()">
        ğŸ—‘ï¸ XÃ³a táº¥t cáº£
      </button>
    </div>

    <div class="container">
      <h2>ğŸ“‹ Káº¿t quáº£</h2>
      <pre id="output">Nháº¥n cÃ¡c nÃºt trÃªn Ä‘á»ƒ test...</pre>
    </div>

    <script>
      const BOOKINGS_KEY = "ev_rental_bookings";

      function log(message, data = null) {
        const output = document.getElementById("output");
        const timestamp = new Date().toLocaleTimeString("vi-VN");
        let text = `[${timestamp}] ${message}\n`;
        if (data) {
          text += JSON.stringify(data, null, 2) + "\n";
        }
        output.textContent = text + "\n" + output.textContent;
      }

      function loadStats() {
        const bookings = JSON.parse(localStorage.getItem(BOOKINGS_KEY)) || [];

        document.getElementById("totalBookings").textContent = bookings.length;
        document.getElementById("pendingBookings").textContent =
          bookings.filter((b) => b.status === "pending_payment").length;
        document.getElementById("bookedBookings").textContent = bookings.filter(
          (b) => b.status === "booked"
        ).length;
        document.getElementById("completedBookings").textContent =
          bookings.filter((b) => b.status === "completed").length;

        log(`âœ… ÄÃ£ load ${bookings.length} bookings`);
      }

      function createTestBooking() {
        const bookings = JSON.parse(localStorage.getItem(BOOKINGS_KEY)) || [];

        const testBooking = {
          id: `BK${Date.now()}-1`,
          userId: "test@test.com",
          userEmail: "test@test.com",
          userName: "KhÃ¡ch hÃ ng Test",
          userPhone: "0123456789",
          vehicleName: "VinFast VF e34",
          vehicleId: "1",
          licensePlate: `59A-${Math.floor(10000 + Math.random() * 90000)}`,
          vehicleImage: "/images/vinfast-vf-e34.jpg",
          pickupDate: "2025-10-20",
          returnDate: "2025-10-25",
          pickupTime: "09:00",
          returnTime: "18:00",
          pickupStation: "Tráº¡m Quáº­n 1",
          returnStation: "Tráº¡m Quáº­n 1",
          days: 5,
          totalPrice: 5000000,
          additionalServices: {},
          paymentMethod: "cash",
          battery: "100%",
          lastCheck: new Date().toISOString(),
          createdAt: new Date().toISOString(),
          status: "pending_payment",
          paymentVerified: false,
          paymentVerifiedAt: null,
          paymentVerifiedBy: null,
        };

        bookings.push(testBooking);
        localStorage.setItem(BOOKINGS_KEY, JSON.stringify(bookings));

        log("âœ… ÄÃ£ táº¡o test booking:", testBooking);
        loadStats();
      }

      function viewAllBookings() {
        const bookings = JSON.parse(localStorage.getItem(BOOKINGS_KEY)) || [];

        if (bookings.length === 0) {
          log("âŒ KhÃ´ng cÃ³ booking nÃ o trong localStorage");
          return;
        }

        log(`ğŸ“¦ TÃ¬m tháº¥y ${bookings.length} bookings:`, bookings);

        // PhÃ¢n loáº¡i theo status
        const byStatus = bookings.reduce((acc, b) => {
          acc[b.status] = (acc[b.status] || 0) + 1;
          return acc;
        }, {});

        log("ğŸ“Š PhÃ¢n loáº¡i theo status:", byStatus);
      }

      function checkStructure() {
        const bookings = JSON.parse(localStorage.getItem(BOOKINGS_KEY)) || [];

        if (bookings.length === 0) {
          log("âŒ KhÃ´ng cÃ³ booking nÃ o Ä‘á»ƒ kiá»ƒm tra");
          return;
        }

        const latest = bookings[bookings.length - 1];
        const requiredFields = [
          "id",
          "userId",
          "userName",
          "userEmail",
          "userPhone",
          "vehicleName",
          "licensePlate",
          "pickupDate",
          "returnDate",
          "pickupStation",
          "returnStation",
          "totalPrice",
          "paymentMethod",
          "status",
          "createdAt",
        ];

        const missingFields = requiredFields.filter((field) => !latest[field]);

        if (missingFields.length > 0) {
          log("âš ï¸ Booking thiáº¿u cÃ¡c fields:", missingFields);
        } else {
          log("âœ… Cáº¥u trÃºc booking há»£p lá»‡!");
        }

        log("ğŸ“‹ Booking má»›i nháº¥t:", latest);
      }

      function clearAllBookings() {
        if (confirm("âš ï¸ Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a Táº¤T Cáº¢ bookings?")) {
          localStorage.removeItem(BOOKINGS_KEY);
          log("ğŸ—‘ï¸ ÄÃ£ xÃ³a táº¥t cáº£ bookings");
          loadStats();
        }
      }

      // Auto load stats on page load
      loadStats();
    </script>
  </body>
</html>
